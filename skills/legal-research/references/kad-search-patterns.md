# Паттерны поиска в kad.arbitr.ru

## Форматы номеров дел

### Стандартный формат
```
А{Код суда}-{Номер}/{Год}
```

**Примеры:**
- `А40-123456/2024` — АС Москвы, дело № 123456 за 2024 год
- `А41-789012/2023` — АС Московской области
- `А45-345678/2024` — АС Санкт-Петербурга
- `А56-901234/2023` — АС Уральского округа

### Коды арбитражных судов

| Код | Суд |
|-----|-----|
| А40 | АС города Москвы |
| А41 | АС Московской области |
| А42 | АС Кемеровской области |
| А43 | АС Нижегородской области |
| А44 | АС Карелии |
| А45 | АС Санкт-Петербурга и Ленинградской области |
| А46 | АС Новосибирской области |
| А47 | АС Оренбургской области |
| А48 | АС Орловской области |
| А49 | АС Пермского края |
| А50 | АС Московской области (второй код) |
| А51 | АС Приморского края |
| А52 | АС Ярославской области |
| А53 | АС Ростовской области |
| А54 | АС Свердловской области |
| А55 | АС Самарской области |
| А56 | АС Уральского округа (кассация) |
| А57 | АС Саратовской области |
| А58 | АС Хабаровского края |
| А59 | АС Красноярского края |
| А60 | АС Челябинской области |
| А61 | АС Краснодарского края |
| А62 | АС Тверской области |
| А63 | АС Ставропольского края |
| А64 | АС Алтайского края |
| А65 | АС Татарстана |
| А66 | АС Брянской области |
| А67 | АС Иркутской области |
| А68 | АС Кировской области |
| А69 | АС Мордовии |
| А70 | АС Тюменской области |
| А71 | АС Ульяновской области |
| А72 | АС Астраханской области |
| А73 | АС Воронежской области |
| А74 | АС Челябинской области (второй код) |
| А75 | АС Забайкальского края |
| А76 | АС Челябинской области (третий код) |
| А77 | АС Москвы (второй код) |
| А78 | АС Санкт-Петербурга (второй код) |
| А79 | АС Нижегородской области (второй код) |
| А80 | АС Ростовской области (второй код) |
| А81 | АС Свердловской области (второй код) |
| А82 | АС Краснодарского края (второй код) |
| А83 | АС Татарстана (второй код) |

---

## Паттерны поисковых запросов

### 1. Поиск по номеру дела
```
А40-123456/2024
```
**Использование:** Когда известен точный номер дела.

### 2. Поиск по статье кодекса
```
статья 330 ГК РФ неустойка
```
**Использование:** Поиск дел по конкретной норме права.

### 3. Поиск по категории спора
```
договор подряда взыскание неустойки
```
**Использование:** Поиск по тематике дела.

### 4. Поиск по участнику
```
ООО «Ромашка»
```
**Использование:** Поиск дел с участием конкретной организации.

---

## Фильтры kad.arbitr.ru

### По категории дела
- **Экономические споры** — основные арбитражные дела
- **Банкротство** — дела о несостоятельности
- **Административные дела** — споры с госорганами
- **Корпоративные споры** — споры внутри компаний

### По инстанции
- **Первая инстанция** — первоначальное рассмотрение
- **Апелляция** — обжалование решений
- **Кассация** — проверка законности
- **Надзор** — исключительная стадия

### По дате
- **За последний год** — актуальная практика
- **За 3 года** — устойчивая практика
- **Все дела** — полный поиск

---

## Rate Limiting и обход блокировок

### Ограничения
- **Максимум:** 1 запрос в 2 секунды
- **Рекомендуется:** 1 запрос в 3-5 секунд
- **Дневной лимит:** ~1000 запросов с одного IP

### Стратегия обхода
```python
import time
import random

def safe_request(query):
    # Базовая задержка
    time.sleep(2.0)
    
    # Случайная вариация (±0.5с)
    time.sleep(random.uniform(0, 0.5))
    
    # Выполнение запроса
    response = make_request(query)
    
    return response
```

### Exponential Backoff при ошибках
```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=2, max=30)
)
def robust_request(query):
    return make_request(query)
```

---

## Парсинг результатов

### Извлечение данных из карточки дела

**Поля для извлечения:**
- `case_number` — номер дела
- `court` — наименование суда
- `parties` — истец и ответчик
- `category` — категория спора
- `decision_date` — дата решения
- `outcome` — результат (удовлетворено/отказано)
- `summary` — краткое описание
- `url` — ссылка на полную карточку

**Пример структуры:**
```json
{
  "case_number": "А40-123456/2024",
  "court": "Арбитражный суд города Москвы",
  "plaintiff": "ООО «Ромашка»",
  "defendant": "ООО «Вектор»",
  "category": "Споры из договоров",
  "decision_date": "2024-10-15",
  "outcome": "Удовлетворено частично",
  "summary": "Взыскание неустойки по договору подряда",
  "url": "https://kad.arbitr.ru/Card/123456"
}
```

---

## Кэширование результатов

### Стратегия
```python
import hashlib
import json

def get_cache_key(query):
    return hashlib.md5(query.encode()).hexdigest()

def cache_results(query, results):
    key = get_cache_key(query)
    with open(f'cache/{key}.json', 'w') as f:
        json.dump({'query': query, 'results': results}, f)

def get_cached_results(query):
    key = get_cache_key(query)
    try:
        with open(f'cache/{key}.json', 'r') as f:
            return json.load(f)
    except FileNotFoundError:
        return None
```

### TTL кэша
- **По номеру дела:** 30 дней (дела редко меняются)
- **По поисковому запросу:** 7 дней (практика обновляется)
- **По участнику:** 14 дней

---

## Troubleshooting

### Проблема: «Дело не найдено»
**Возможные причины:**
1. Неверный формат номера (проверь дефисы и слеши)
2. Дело ещё не зарегистрировано
3. Дело архивировано

**Решение:**
- Проверь номер на сайте суда
- Попробуй поиск без года: `А40-123456`
- Используй альтернативные источники (Sudact.ru, Pravo.gov.ru)

### Проблема: «Слишком много запросов»
**Решение:**
- Увеличь задержку до 5 секунд
- Используй кэширование
- Раздели запросы на сессии с перерывами

### Проблема: «HTML изменился, парсер не работает»
**Решение:**
- Проверь актуальные селекторы в DevTools
- Обнови `src/tools/kad_parser.py`
- Добавь fallback на RSS/API если доступно

---

## Альтернативные источники

| Источник | URL | Особенности |
|----------|-----|-------------|
| **Sudact.ru** | https://sudact.ru/ | Поиск по всем судам РФ |
| **Pravo.gov.ru** | https://pravo.gov.ru/ | Официальный портал |
| **RosPravoSud** | https://rospravosudie.com/ | Агрегатор практики |
| **Consultant.ru** | https://www.consultant.ru/ | Судебная практика + нормы |
| **Garant.ru** | https://www.garant.ru/ | Судебная практика + нормы |

---

> ⚠️ **Важно:** Kad.arbitr.ru предоставляет информацию для ознакомления. Для официальных целей запрашивай заверенные копии решений в суде.
