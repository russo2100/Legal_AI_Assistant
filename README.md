# Legal AI Assistant (RU) ‚Äî –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π RAG-–∞–≥–µ–Ω—Ç

> –í–µ—Ä—Å–∏—è: 1.0.0 | –§—Ä–µ–π–º–≤–æ—Ä–∫: LangGraph | –Æ—Ä–∏—Å–¥–∏–∫—Ü–∏—è: –†–§

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–æ–≤ –∏ —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –†–§ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG (Retrieval-Augmented Generation) –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ LangGraph.

## üìå –ù–æ–≤–æ–µ: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ RAG

- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** [`QUICKSTART.md`](QUICKSTART.md)
- üìñ **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** [`docs/SETUP_GUIDE.md`](docs/SETUP_GUIDE.md)
- üîó **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:** [`docs/DATA_SOURCES_INTEGRATION.md`](docs/DATA_SOURCES_INTEGRATION.md)
- üìä **–û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** [`docs/RAG_IMPLEMENTATION_REPORT.md`](docs/RAG_IMPLEMENTATION_REPORT.md)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv
.\venv\Scripts\Activate.ps1  # PowerShell
# –∏–ª–∏
.\venv\Scripts\activate.bat  # CMD

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
Copy-Item .env.example .env

# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ .env —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
# OPENROUTER_API_KEY=–≤–∞—à_–∫–ª—é—á
# PERPLEXITY_API_KEY=–≤–∞—à_–∫–ª—é—á_fallback
# DATABASE_URL=postgresql://user:pass@localhost:5432/yurik_db
```

**–í–∞–∂–Ω–æ:** –î–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–∞ LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
- **OpenRouter** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- **Perplexity** ‚Äî fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ

üìÑ **–ü–æ–¥—Ä–æ–±–Ω–æ:** —Å–º. [`docs/llm-fallback-system.md`](docs/llm-fallback-system.md)

### 3. –ó–∞–ø—É—Å–∫

#### CLI –≤–µ—Ä—Å–∏—è (–∫–æ–Ω—Å–æ–ª—å)
```bash
# –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º
python src/main.py "–°—Ç–∞—Ç—å—è 330 –ì–ö –†–§ –Ω–µ—É—Å—Ç–æ–π–∫–∞"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest src/tests -v

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–¥–µ–∫—Å–æ–≤
python src/rag/indexer.py --codes data/codes
```

#### Dashboard (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
python -m src.api.server

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
cd frontend
npm install
npm run dev
```

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ `http://localhost:3000`

---

## üñ•Ô∏è Dashboard

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–∏–ª–µ 1–° —Å –ø–æ–∏—Å–∫–æ–º –∏ –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **–ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞** ‚Äî –≤–≤–æ–¥ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **–õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
- **–ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
- **–ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

üìÑ **–ü–æ–¥—Ä–æ–±–Ω–æ:** —Å–º. [`frontend/README.md`](frontend/README.md)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
yurik/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/             # FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è Dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.py    # API endpoints (/api/search, /api/health)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ graph/           # LangGraph workflow
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ state.py     # AgentState (TypedDict)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nodes.py     # –£–∑–ª—ã –≥—Ä–∞—Ñ–∞ (classify, search, generate...)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workflow.py  # –°–±–æ—Ä–∫–∞ –≥—Ä–∞—Ñ–∞
‚îÇ   ‚îú‚îÄ‚îÄ rag/             # RAG-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py # OpenRouter embedder
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ indexer.py   # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–µ–∫—Å–æ–≤ –≤ pgvector
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ retriever.py # –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (BM25 + vector)
‚îÇ   ‚îú‚îÄ‚îÄ tools/           # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kad_parser.py # –ü–∞—Ä—Å–µ—Ä kad.arbitr.ru
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ citation_check.py # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ legal_utils.py # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ llm/             # LLM-–∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py    # OpenRouter client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompts.py   # Jinja2 —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ prompts/         # Prompt-—à–∞–±–ª–æ–Ω—ã (.j2)
‚îÇ   ‚îú‚îÄ‚îÄ tests/           # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py
‚îÇ   ‚îî‚îÄ‚îÄ main.py          # CLI —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ frontend/            # React + TypeScript Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/         # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/       # –°—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ codes/           # –¢–µ–∫—Å—Ç—ã –∫–æ–¥–µ–∫—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ cache/           # –ö—ç—à –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ docs/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ logs/                # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker/              # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ requirements.txt
```

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Workflow –≥—Ä–∞—Ñ–∞

```
START ‚Üí classify_query ‚Üí search_norms ‚Üí search_cases ‚Üí generate_answer ‚Üí verify_citation ‚Üí END
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| **classify_query** | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ —Ç–∏–ø—É –ø—Ä–∞–≤–∞ |
| **search_norms** | –ü–æ–∏—Å–∫ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–æ–≤ (RAG) |
| **search_cases** | –ü–æ–∏—Å–∫ —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ (kad.arbitr.ru) |
| **generate_answer** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ LLM |
| **verify_citation** | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |

### LangGraph Integration

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **LangGraph 1.0.3** ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É.

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º:**
- ‚úÖ StateGraph —Å TypedDict (`src/graph/state.py`)
- ‚úÖ –£–∑–ª—ã –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ (`src/graph/nodes.py`)
- ‚úÖ START/END –∏–∑ –Ω–æ–≤–æ–≥–æ API (`src/graph/workflow.py`)
- ‚úÖ Durable execution —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–¥–∞—á—É state
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

üìÑ **–ü–æ–¥—Ä–æ–±–Ω–æ:** —Å–º. `docs/langgraph-integration.md`

## üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest src/tests -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å
pytest src/tests/test_nodes.py -v

# E2E —Ç–µ—Å—Ç—ã –Ω–∞ golden set
pytest src/tests/test_e2e.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=src src/tests
```

## üê≥ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL —Å pgvector
docker compose -f docker/docker-compose.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose ps
```

## üîë API-–∫–ª—é—á–∏

### OpenRouter

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://openrouter.ai
2. –°–æ–∑–¥–∞–π—Ç–µ API-–∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```
   OPENROUTER_API_KEY=sk-or-...
   OPENROUTER_MODEL=qwen/qwen-2.5-72b-instruct
   ```

### PostgreSQL

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
# Docker
docker run -d --name yurik-postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=yurik_db \
  -p 5432:5432 \
  pgvector/pgvector:pg16
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü–æ–∏—Å–∫ –Ω–æ—Ä–º—ã –ø–æ —Å—Ç–∞—Ç—å–µ
python src/main.py "–°—Ç–∞—Ç—å—è 330 –ì–ö –†–§"

# –í–æ–ø—Ä–æ—Å –æ –Ω–µ—É—Å—Ç–æ–π–∫–µ
python src/main.py "–ö–∞–∫ –≤–∑—ã—Å–∫–∞—Ç—å –Ω–µ—É—Å—Ç–æ–π–∫—É –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –ø–æ—Å—Ç–∞–≤–∫–∏?"

# –ü–æ–∏—Å–∫ –¥–µ–ª–∞ –ø–æ –Ω–æ–º–µ—Ä—É
python src/main.py "–î–µ–ª–æ –ê40-123456/2024"

# –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É
python src/main.py "–†–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ –∞—Ä–µ–Ω–¥—ã –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ"
```

## ‚ö†Ô∏è –î–∏—Å–∫–ª–µ–π–º–µ—Ä

> **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —é—Ä–∏—Å—Ç–æ–º.**

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/`
- –õ–æ–≥ –æ—à–∏–±–æ–∫: `docs/error-log.md`
- –ü—Ä–æ–≥—Ä–µ—Å—Å: `docs/progress.md`
