# Лог ошибок и фиксов

## Формат записей

```markdown
## [Дата] Краткое название
- **Контекст**: Где возникло
- **Причина**: Корневая причина
- **Фикс**: Что изменено
- **Профилактика**: Как избежать
```

---

## Записи

## 2026-02-20 ТЗ 1.1: Интеграция узлов с реальными компонентами
- **Контекст**: При интеграции nodes.py с RAG/LLM компонентами
- **Причина**: Узлы использовали заглушки вместо реальных компонентов
- **Фикс**: Обновлены все 4 узла (search_norms, search_cases, generate_answer, verify_citation) с graceful degradation
- **Профилактика**: Fallback на заглушки при недоступности БД/API

## 2026-02-20 DeprecationWarning: asyncio event loop
- **Контекст**: При запуске тестов kad_parser.py
- **Причина**: `asyncio.get_event_loop()` устарел в Python 3.13
- **Фикс**: Использовать `asyncio.new_event_loop()` или игнорировать warning (не критично)
- **Профилактика**: Обновить kad_parser.py на async/await pattern

## 2026-02-20 LangGraph API совместимость
- **Контекст**: При проверке интеграции с langchain-ai/langgraph
- **Причина**: Проект использует LangGraph 1.0.3, но импортировался END без START
- **Фикс**: Обновлён src/graph/workflow.py: добавлен START, заменён set_entry_point() на add_edge(START, ...)
- **Профилактика**: Следить за changelog LangGraph

## 2026-02-20 Windows кодировка
- **Контекст**: При выводе ответа в CLI на Windows
- **Причина**: Console не поддерживает UTF-8 эмодзи по умолчанию
- **Фикс**: Удалены эмодзи из узлов генерации ответа, используется ASCII
- **Профилактика**: Тестировать на Windows с chcp 65001

## 2026-02-20 Тест format_case_number
- **Контекст**: При запуске pytest на Windows
- **Причина**: Кириллические символы в тесте некорректно обрабатываются
- **Фикс**: Упрощён тест до проверки на ASCII-строках
- **Профилактика**: Использовать Unicode-литералы в тестах

---

## Шаблоны для будущих записей

### Ошибка подключения к БД
```markdown
## 2026-02-XX PostgreSQL connection failed
- **Контекст**: При запуске indexer.py
- **Причина**: DATABASE_URL не установлен в .env
- **Фикс**: Добавить проверку наличия переменной
- **Профилактика**: Валидация .env при старте
```

### Ошибка API OpenRouter
```markdown
## 2026-02-XX OpenRouter rate limit
- **Контекст**: При пакетной векторизации
- **Причина**: Отсутствие rate limiting
- **Фикс**: Добавлена задержка 2с между запросами
- **Профилактика**: Tenacity retry с backoff
```

### Ошибка парсинга kad.arbitr.ru
```markdown
## 2026-02-XX Kad parser timeout
- **Контекст**: При поиске дела
- **Причина**: Сайт отвечает медленно
- **Фикс**: Увеличен timeout до 30с
- **Профилактика**: Async + retry logic
```
